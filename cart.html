<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cart ‚Äî Yaldah Issa</title>
  <meta name="description" content="Your cart ‚Äî Yaldah Issa." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="assets/styles.css?v=20" />
</head>

<body>
  <!-- HEADER -->
  <header class="site-header" aria-label="Site header">
    <div class="header-left">
      <button class="menu-btn" id="menuBtn" aria-label="Open menu" aria-expanded="false" aria-controls="menuPanel">
        <span></span><span></span><span></span>
      </button>
    </div>

    <div class="header-center">
      <a class="brandmark" href="index.html" aria-label="Yaldah Issa Home">
        <img src="assets/IMG_2654.jpeg" alt="Yaldah Issa Logo" class="brand-logo">
        <span class="brand-name">YALDAH ISSA</span>
      </a>
    </div>

    <div class="header-right">
      <nav class="topnav" aria-label="Primary navigation">
        <a class="navpill" href="index.html">Home</a>
        <a class="navpill" href="shop.html">Shop</a>
        <a class="navpill" href="about.html">About</a>
        <a class="navpill" href="contact.html">Contact</a>
        <a class="navpill navpill-cart" href="cart.html">Cart (<span id="cartCount">0</span>)</a>
      </nav>
    </div>

    <div class="menu-panel" id="menuPanel" role="dialog" aria-label="Menu" aria-hidden="true">
      <a class="menu-item" href="shop.html?collection=Rich%20Aunty%20Sets">Rich Aunty Sets</a>
      <a class="menu-item" href="shop.html?collection=Signature%20Dresses">Signature Dresses</a>
      <a class="menu-item" href="shop.html?collection=Power%20Suits">Power Suits</a>
    </div>
    <div class="menu-backdrop" id="menuBackdrop" aria-hidden="true"></div>
  </header>

  <main class="container">
    <section class="section">
      <div class="section-head">
        <h2>Your Cart</h2>
        <div class="note"><a class="navpill" href="shop.html">‚Üê Continue shopping</a></div>
      </div>

      <div class="cart-wrap">
        <!-- ITEMS -->
        <div class="panel cart-panel">
          <div id="cartItems"></div>

          <div id="cartEmpty" style="display:none; padding:18px; opacity:.85;">
            Your cart is empty.
            <div style="margin-top:14px">
              <a class="btn primary" href="shop.html">Shop ‚Üí</a>
            </div>
          </div>
        </div>

        <!-- SUMMARY -->
        <aside class="panel cart-summary">
          <h3 class="cart-summary-title">Order Summary</h3>

          <div class="cart-summary-row">
            <span>Subtotal</span>
            <strong id="subTotal">$0.00</strong>
          </div>

          <div class="cart-summary-row">
            <span>Shipping</span>
            <span class="muted">Calculated at checkout</span>
          </div>

          <div class="cart-summary-row">
            <span>Taxes</span>
            <span class="muted">Calculated at checkout</span>
          </div>

          <div class="cart-summary-divider"></div>

          <div class="cart-summary-row total">
            <span>Total</span>
            <strong id="grandTotal">$0.00</strong>
          </div>

          <a class="btn primary cart-checkout-btn" href="checkout.html">Secure Checkout ‚Üí</a>

          <div class="secure-line">üîí Secure checkout ‚Ä¢ Encrypted payments</div>

          <div class="pay-row">
            <span class="pay-pill">Klarna</span>
            <span class="pay-pill">Sezzle</span>
            <span class="pay-pill">Shop Pay</span>
            <span class="pay-pill">Visa</span>
            <span class="pay-pill">Mastercard</span>
            <span class="pay-pill">Amex</span>
          </div>

          <div class="muted" style="margin-top:10px; font-size:12px;">
            Pre-order / limited release items ship within 7‚Äì14 business days.
          </div>
        </aside>
      </div>
    </section>

    <footer class="footer">
      <div>¬© <span id="year"></span> Yaldah Issa ‚Äî Excellence With Purpose</div>
      <div class="footer-links">
        <a href="policies/shipping.html">Shipping</a> ‚Ä¢
        <a href="policies/returns.html">Returns</a> ‚Ä¢
        <a href="policies/privacy.html">Privacy</a> ‚Ä¢
        <a href="policies/terms.html">Terms</a>
        <span class="sep">|</span>
        <span>Contact: <a href="mailto:yaldahisa@gmail.com">yaldahisa@gmail.com</a></span>
      </div>
    </footer>
  </main>

  <script type="module">
    import { PRODUCTS } from "./assets/products.js";
    import { getCart, setCart, removeFromCart } from "./assets/cart.js";
    import { setYear, setCartCount, money } from "./assets/app.js";

    setYear(); setCartCount();

    const itemsEl = document.getElementById("cartItems");
    const emptyEl = document.getElementById("cartEmpty");
    const subTotalEl = document.getElementById("subTotal");
    const grandTotalEl = document.getElementById("grandTotal");

    function parseKey(key){
      const [id, size] = key.split("::");
      return { id, size };
    }

    function render(){
      const cart = getCart(); // object map
      const keys = Object.keys(cart || {});
      itemsEl.innerHTML = "";

      if(!keys.length){
        emptyEl.style.display = "block";
        subTotalEl.textContent = "$0.00";
        grandTotalEl.textContent = "$0.00";
        return;
      }
      emptyEl.style.display = "none";

      let subtotalCents = 0;

      keys.forEach((key) => {
        const qty = Number(cart[key] || 0);
        if(qty <= 0) return;

        const { id, size } = parseKey(key);
        const p = PRODUCTS.find(x => x.id === id);
        if(!p) return;

        const line = p.price_cents * qty;
        subtotalCents += line;

        const row = document.createElement("div");
        row.className = "cart-item";

        row.innerHTML = `
          <div class="cart-img">
            <img src="${p.images?.[0] || ""}" alt="${p.name}">
          </div>

          <div class="cart-info">
            <div class="cart-name">${p.name}</div>
            <div class="cart-meta">${p.collection} ‚Ä¢ Size: ${size}</div>
            <div class="cart-meta">${p.color} ‚Ä¢ ${p.fabric}</div>

            <div class="cart-actions">
              <label class="cart-qty">
                <span>Qty</span>
                <select data-key="${key}" class="qtySelect">
                  ${[1,2,3,4,5].map(n => `<option value="${n}" ${n===qty?"selected":""}>${n}</option>`).join("")}
                </select>
              </label>

              <button class="cart-remove" data-key="${key}" type="button">Remove</button>
            </div>
          </div>

          <div class="cart-line">
            <div class="cart-price">${money(p.price_cents)}</div>
            <div class="cart-line-total">${money(line)}</div>
          </div>
        `;

        itemsEl.appendChild(row);
      });

      subTotalEl.textContent = money(subtotalCents);
      grandTotalEl.textContent = money(subtotalCents);

      // listeners
      document.querySelectorAll(".qtySelect").forEach(sel => {
        sel.addEventListener("change", (e) => {
          const key = e.target.getAttribute("data-key");
          const newQty = Number(e.target.value || 1);
          const cartNow = getCart();
          cartNow[key] = newQty;
          setCart(cartNow);
          setCartCount();
          render();
        });
      });

      document.querySelectorAll(".cart-remove").forEach(btn => {
        btn.addEventListener("click", (e) => {
          const key = e.target.getAttribute("data-key");
          removeFromCart(key);
          setCartCount();
          render();
        });
      });
    }

    render();
  </script>

  <!-- MENU SCRIPT -->
  <script>
    const menuBtn = document.getElementById("menuBtn");
    const menuPanel = document.getElementById("menuPanel");
    const menuBackdrop = document.getElementById("menuBackdrop");

    function closeMenu(){
      if(!menuBtn || !menuPanel || !menuBackdrop) return;
      menuBtn.setAttribute("aria-expanded","false");
      menuPanel.classList.remove("open");
      menuBackdrop.classList.remove("open");
      menuPanel.setAttribute("aria-hidden","true");
    }

    function openMenu(){
      if(!menuBtn || !menuPanel || !menuBackdrop) return;
      menuBtn.setAttribute("aria-expanded","true");
      menuPanel.classList.add("open");
      menuBackdrop.classList.add("open");
      menuPanel.setAttribute("aria-hidden","false");
    }

    menuBtn?.addEventListener("click", () => {
      const isOpen = menuBtn.getAttribute("aria-expanded") === "true";
      isOpen ? closeMenu() : openMenu();
    });

    menuBackdrop?.addEventListener("click", closeMenu);
    window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeMenu(); });
  </script>

</body>
</html>

